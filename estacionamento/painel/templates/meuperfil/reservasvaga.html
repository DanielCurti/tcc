{%extends 'meuperfil/base.html'%}
{%block content%}
{%load static%}
<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" type="text/javascript"></script>
  
</head>
<script type="text/javascript">
    $(document).on("click", "button", function() {
        var valor = $(this).val();
        var div = $(this).closest('div.transacao');
        var idt = $(this).closest('div.transacao').attr('id');
        $.ajax({
                    method:"POST",
                    url: "api/avaliacao2",
                    data: {idtransacao: idt, nota: valor}
                 }).done(function(data) {
                    if (data.status == "Ok") {
                        ajusta(valor, div); 
                    }else{
                        alert("Erro ao avaliar transação");
                    }
        
        });
    });
    function ajusta(valor, div) {
        $(div).find("#0").css({'color': 'black'});
        $(div).find("#1").css({'color': 'black'});
        $(div).find("#2").css({'color': 'black'});
        $(div).find("#3").css({'color': 'black'});
        $(div).find("#4").css({'color': 'black'});
        if (valor == '0') {
        $(div).find("#0").css({'color': 'yellow'});
        }
        if  (valor == '1') {
        $(div).find("#0").css({'color': 'yellow'});
        $(div).find("#1").css({'color': 'yellow'});
        }
        if (valor == '2') {
        $(div).find("#0").css({'color': 'yellow'});
        $(div).find("#1").css({'color': 'yellow'});
        $(div).find("#2").css({'color': 'yellow'});
        }
        if (valor == '3') {
        $(div).find("#0").css({'color': 'yellow'});
        $(div).find("#1").css({'color': 'yellow'});
        $(div).find("#2").css({'color': 'yellow'});
        $(div).find("#3").css({'color': 'yellow'});
        }
        if (valor == '4') {
        $(div).find("#0").css({'color': 'yellow'});
        $(div).find("#1").css({'color': 'yellow'});
        $(div).find("#2").css({'color': 'yellow'});
        $(div).find("#3").css({'color': 'yellow'});
        $(div).find("#4").css({'color': 'yellow'});
        }
    }

</script>
<body>


 <h1> Suas Locações </h1>
 
 <ul>
 {% for t in lista_locatarios %}
    <div id="{{t.id}}" class="transacao"><li>Vaga {{t.vaga}} no dia {{t.data}} - R$ {{t.valor}} - Locatario {{t.locatario}}
        {% if t.avaliacaolocador == -1 %}
            <button id="0" value="0" class="btn"><i class='fas fa-star'></i></button>
            <button id="1" value="1" class="btn"><i class='fas fa-star'></i></button>
            <button id="2" value="2" class="btn"><i class='fas fa-star'></i></button>
            <button id="3" value="3" class="btn"><i class='fas fa-star'></i></button>
            <button id="4" value="4" class="btn"><i class='fas fa-star'></i></button>
        </li></div>
        {% else %}
            {% for x in r %}
                {% if x < t.avaliacaolocador %}
                    <button id="{{x}}" value="{{x}}" class="btn" style="color: yellow;"><i class='fas fa-star'></i></button>
                {% else %}
                    <button id="{{x}}" value="{{x}}" class="btn"><i class='fas fa-star'></i></button>
                {% endif %}
            
            {% endfor %}
        </li></div>
        {% endif %}
        <br>
 {% endfor %}
 </ul>

 </body>
</html>
{%endblock%}